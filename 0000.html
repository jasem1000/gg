<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام كاشير مطعم عراقي</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #4CAF50;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            display: flex;
            flex-wrap: wrap;
        }
        .categories {
            flex: 1;
            min-width: 300px;
            padding: 10px;
        }
        .category {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .item:last-child {
            border-bottom: none;
        }
        .item button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .item button:hover {
            background: #45a049;
        }
        .cart {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        .cart-item:last-child {
            border-bottom: none;
        }
        .total {
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        #admin-section, #stats-section {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input, select {
            padding: 8px;
            margin: 5px 0;
            width: calc(100% - 16px);
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .printable {
            display: none;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .printable, .printable * {
                visibility: visible;
            }
            .printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>نظام كاشير مطعم عراقي</h1>
    <div class="container">
        <div class="categories">
            <h2>الأقسام</h2>
            <div id="categories-list"></div>
        </div>
        <div class="cart">
            <h2>السلة</h2>
            <div id="cart-items"></div>
            <div class="total">الإجمالي: <span id="total">0</span> دينار عراقي</div>
            <button onclick="checkout()">إنهاء الطلب</button>
            <button onclick="clearCart()">مسح السلة</button>
        </div>
    </div>
    <button onclick="showAdmin()">إضافة وجبة أو قسم جديد</button>
    <button onclick="promptStats()">عرض الإحصائيات</button>

    <div id="admin-section">
        <h2>إدارة الأصناف</h2>
        <select id="admin-category">
            <option value="">اختر قسمًا موجودًا أو أضف جديد</option>
        </select>
        <input type="text" id="new-category" placeholder="اسم قسم جديد (اختياري)">
        <input type="text" id="item-name" placeholder="اسم الوجبة">
        <input type="number" id="item-price" placeholder="السعر بالدينار العراقي">
        <button onclick="addItem()">إضافة</button>
        <button onclick="hideAdmin()">إغلاق</button>
    </div>

    <div id="stats-section">
        <h2>الإحصائيات</h2>
        <p>المبيعات اليومية: <span id="daily-sales">0</span> دينار</p>
        <p>المبيعات الشهرية: <span id="monthly-sales">0</span> دينار</p>
        <p>المبيعات السنوية: <span id="yearly-sales">0</span> دينار</p>
        <button onclick="hideStats()">إغلاق</button>
    </div>

    <!-- Printable Invoices -->
    <div id="customer-invoice" class="printable">
        <h2>فاتورة الزبون</h2>
        <div id="customer-items"></div>
        <p>الإجمالي: <span id="customer-total"></span> دينار عراقي</p>
        <p>شكرًا لزيارتكم!</p>
    </div>

    <div id="kitchen-invoice" class="printable">
        <h2>فاتورة المطبخ</h2>
        <div id="kitchen-items"></div>
    </div>

    <script>
        let categories = JSON.parse(localStorage.getItem('categories')) || {
            'الأكل': [],
            'المشروبات': []
        };
        let cart = [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];

        function saveData() {
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('sales', JSON.stringify(sales));
        }

        function loadCategories() {
            const list = document.getElementById('categories-list');
            list.innerHTML = '';
            const adminSelect = document.getElementById('admin-category');
            adminSelect.innerHTML = '<option value="">اختر قسمًا موجودًا أو أضف جديد</option>';
            for (let cat in categories) {
                const catDiv = document.createElement('div');
                catDiv.className = 'category';
                catDiv.innerHTML = `<h3>${cat}</h3>`;
                categories[cat].forEach(item => {
                    catDiv.innerHTML += `
                        <div class="item">
                            <span>${item.name} - ${item.price} دينار</span>
                            <button onclick="addToCart('${cat}', '${item.name}')">إضافة</button>
                        </div>
                    `;
                });
                list.appendChild(catDiv);

                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                adminSelect.appendChild(option);
            }
        }

        function addToCart(cat, name) {
            const item = categories[cat].find(i => i.name === name);
            const cartItem = cart.find(i => i.name === name);
            if (cartItem) {
                cartItem.quantity++;
            } else {
                cart.push({ ...item, quantity: 1 });
            }
            updateCart();
        }

        function updateCart() {
            const itemsDiv = document.getElementById('cart-items');
            itemsDiv.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                const subTotal = item.price * item.quantity;
                total += subTotal;
                itemsDiv.innerHTML += `
                    <div class="cart-item">
                        <span>${item.name} x${item.quantity} - ${subTotal} دينار</span>
                        <button onclick="removeFromCart('${item.name}')">إزالة</button>
                    </div>
                `;
            });
            document.getElementById('total').textContent = total;
        }

        function removeFromCart(name) {
            const index = cart.findIndex(i => i.name === name);
            if (index > -1) {
                if (cart[index].quantity > 1) {
                    cart[index].quantity--;
                } else {
                    cart.splice(index, 1);
                }
            }
            updateCart();
        }

        function clearCart() {
            cart = [];
            updateCart();
        }

        function checkout() {
            if (cart.length === 0) return alert('السلة فارغة!');
            const total = parseInt(document.getElementById('total').textContent);
            const date = new Date().toISOString().split('T')[0];

            // Prepare invoices
            let itemsHtml = '';
            cart.forEach(item => {
                itemsHtml += `<p>${item.name} x${item.quantity} - ${item.price * item.quantity} دينار</p>`;
            });

            // Customer Invoice
            document.getElementById('customer-items').innerHTML = itemsHtml;
            document.getElementById('customer-total').innerHTML = total;
            document.getElementById('customer-invoice').style.display = 'block';
            window.print();
            document.getElementById('customer-invoice').style.display = 'none';

            // Kitchen Invoice
            document.getElementById('kitchen-items').innerHTML = itemsHtml.replace(/ - \d+ دينار/g, ''); // Remove prices for kitchen
            document.getElementById('kitchen-invoice').style.display = 'block';
            window.print();
            document.getElementById('kitchen-invoice').style.display = 'none';

            // Save sale
            sales.push({ date, items: [...cart], total });
            saveData();
            clearCart();
        }

        function showAdmin() {
            document.getElementById('admin-section').style.display = 'block';
        }

        function hideAdmin() {
            document.getElementById('admin-section').style.display = 'none';
        }

        function addItem() {
            let cat = document.getElementById('admin-category').value;
            const newCat = document.getElementById('new-category').value.trim();
            const name = document.getElementById('item-name').value.trim();
            const price = parseInt(document.getElementById('item-price').value);

            if (newCat) cat = newCat;
            if (!cat || !name || isNaN(price)) return alert('يرجى ملء جميع الحقول!');

            if (!categories[cat]) categories[cat] = [];
            categories[cat].push({ name, price });
            saveData();
            loadCategories();
            hideAdmin();
        }

        function promptStats() {
            const pin = prompt('أدخل الرمز السري:');
            if (pin === '1000') {
                calculateStats();
                document.getElementById('stats-section').style.display = 'block';
            } else {
                alert('رمز خاطئ!');
            }
        }

        function hideStats() {
            document.getElementById('stats-section').style.display = 'none';
        }

        function calculateStats() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const month = today.slice(0, 7);
            const year = today.slice(0, 4);

            let daily = 0, monthly = 0, yearly = 0;
            sales.forEach(sale => {
                if (sale.date === today) daily += sale.total;
                if (sale.date.startsWith(month)) monthly += sale.total;
                if (sale.date.startsWith(year)) yearly += sale.total;
            });

            document.getElementById('daily-sales').textContent = daily;
            document.getElementById('monthly-sales').textContent = monthly;
            document.getElementById('yearly-sales').textContent = yearly;
        }

        loadCategories();
        updateCart();
    </script>
</body>
</html>
